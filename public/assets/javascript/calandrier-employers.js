// Jours f√©ri√©s du Gabon pour 2025-2030
const gabonHolidays = {
    // 2025
    '2025-01-01': 'Jour de l\'An',
    '2025-02-14': 'Saint-Valentin',
    '2025-03-08': 'Journ√©e Internationale de la Femme',
    '2025-03-12': 'F√™te de la R√©novation',
    '2025-04-18': 'Vendredi Saint',
    '2025-04-21': 'Lundi de P√¢ques',
    '2025-05-01': 'F√™te du Travail',
    '2025-05-11': 'F√™te des M√®res',
    '2025-05-29': 'Ascension',
    '2025-06-09': 'Lundi de Pentec√¥te',
    '2025-06-15': 'F√™te des P√®res',
    '2025-08-15': 'Assomption',
    '2025-08-17': 'F√™te de l\'Ind√©pendance',
    '2025-10-31': 'Halloween',
    '2025-11-01': 'Toussaint',
    '2025-12-25': 'No√´l',
    '2025-12-31': 'R√©veillon du Nouvel An',

    // 2026
    '2026-01-01': 'Jour de l\'An',
    '2026-02-14': 'Saint-Valentin',
    '2026-03-08': 'Journ√©e Internationale de la Femme',
    '2026-03-12': 'F√™te de la R√©novation',
    '2026-04-03': 'Vendredi Saint',
    '2026-04-06': 'Lundi de P√¢ques',
    '2026-05-01': 'F√™te du Travail',
    '2026-05-14': 'Ascension',
    '2026-05-24': 'F√™te des M√®res',
    '2026-05-25': 'Lundi de Pentec√¥te',
    '2026-06-21': 'F√™te des P√®res',
    '2026-08-15': 'Assomption',
    '2026-08-17': 'F√™te de l\'Ind√©pendance',
    '2026-10-31': 'Halloween',
    '2026-11-01': 'Toussaint',
    '2026-12-25': 'No√´l',
    '2026-12-31': 'R√©veillon du Nouvel An',

    // 2027
    '2027-01-01': 'Jour de l\'An',
    '2027-02-14': 'Saint-Valentin',
    '2027-03-08': 'Journ√©e Internationale de la Femme',
    '2027-03-12': 'F√™te de la R√©novation',
    '2027-03-26': 'Vendredi Saint',
    '2027-03-29': 'Lundi de P√¢ques',
    '2027-05-01': 'F√™te du Travail',
    '2027-05-06': 'Ascension',
    '2027-05-09': 'F√™te des M√®res',
    '2027-05-17': 'Lundi de Pentec√¥te',
    '2027-06-20': 'F√™te des P√®res',
    '2027-08-15': 'Assomption',
    '2027-08-17': 'F√™te de l\'Ind√©pendance',
    '2027-10-31': 'Halloween',
    '2027-11-01': 'Toussaint',
    '2027-12-25': 'No√´l',
    '2027-12-31': 'R√©veillon du Nouvel An',

    // 2028
    '2028-01-01': 'Jour de l\'An',
    '2028-02-14': 'Saint-Valentin',
    '2028-03-08': 'Journ√©e Internationale de la Femme',
    '2028-03-12': 'F√™te de la R√©novation',
    '2028-04-14': 'Vendredi Saint',
    '2028-04-17': 'Lundi de P√¢ques',
    '2028-05-01': 'F√™te du Travail',
    '2028-05-25': 'Ascension',
    '2028-05-28': 'F√™te des M√®res',
    '2028-06-05': 'Lundi de Pentec√¥te',
    '2028-06-18': 'F√™te des P√®res',
    '2028-08-15': 'Assomption',
    '2028-08-17': 'F√™te de l\'Ind√©pendance',
    '2028-10-31': 'Halloween',
    '2028-11-01': 'Toussaint',
    '2028-12-25': 'No√´l',
    '2028-12-31': 'R√©veillon du Nouvel An',

    // 2029
    '2029-01-01': 'Jour de l\'An',
    '2029-02-14': 'Saint-Valentin',
    '2029-03-08': 'Journ√©e Internationale de la Femme',
    '2029-03-12': 'F√™te de la R√©novation',
    '2029-03-30': 'Vendredi Saint',
    '2029-04-02': 'Lundi de P√¢ques',
    '2029-05-01': 'F√™te du Travail',
    '2029-05-10': 'Ascension',
    '2029-05-13': 'F√™te des M√®res',
    '2029-05-21': 'Lundi de Pentec√¥te',
    '2029-06-17': 'F√™te des P√®res',
    '2029-08-15': 'Assomption',
    '2029-08-17': 'F√™te de l\'Ind√©pendance',
    '2029-10-31': 'Halloween',
    '2029-11-01': 'Toussaint',
    '2029-12-25': 'No√´l',
    '2029-12-31': 'R√©veillon du Nouvel An',

    // 2030
    '2030-01-01': 'Jour de l\'An',
    '2030-02-14': 'Saint-Valentin',
    '2030-03-08': 'Journ√©e Internationale de la Femme',
    '2030-03-12': 'F√™te de la R√©novation',
    '2030-04-19': 'Vendredi Saint',
    '2030-04-22': 'Lundi de P√¢ques',
    '2030-05-01': 'F√™te du Travail',
    '2030-05-26': 'F√™te des M√®res',
    '2030-05-30': 'Ascension',
    '2030-06-10': 'Lundi de Pentec√¥te',
    '2030-06-16': 'F√™te des P√®res',
    '2030-08-15': 'Assomption',
    '2030-08-17': 'F√™te de l\'Ind√©pendance',
    '2030-10-31': 'Halloween',
    '2030-11-01': 'Toussaint',
    '2030-12-25': 'No√´l',
    '2030-12-31': 'R√©veillon du Nouvel An',
};

// Variables globales pour les donn√©es du backend
let employeeData = null;
let typesConges = [];
let congesApprouves = [];
let statistiquesParType = [];

// Configuration du calendrier
const calendarData = {
    currentDate: new Date(),
    currentMonth: new Date().getMonth(),
    currentYear: new Date().getFullYear(),
};

// Initialisation de Notyf
const notyf = new Notyf({
    duration: 3000,
    position: { x: 'right', y: 'top' }
});

// ====== FONCTIONS DE R√âCUP√âRATION DES DONN√âES DEPUIS LE BACKEND ======

/**
 * Charge toutes les donn√©es de cong√©s depuis le backend
 */
async function chargerDonneesConges() {
    try {
        const response = await fetch('/employes/api/employe/conges-data', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
            }
        });

        if (!response.ok) {
            throw new Error('Erreur lors de la r√©cup√©ration des donn√©es');
        }

        const result = await response.json();

        if (result.success) {
            employeeData = result.data.employe;
            typesConges = result.data.types_conges;
            congesApprouves = result.data.conges;
            statistiquesParType = result.data.statistiques;

            console.log('‚úÖ Donn√©es charg√©es:', result.data);
            console.log('üìä Cong√©s approuv√©s:', congesApprouves);

            // Mettre √† jour l'interface
            afficherStatistiquesConges();
            renderCalendar();
            afficherLegende();
        } else {
            throw new Error(result.message);
        }
    } catch (error) {
        console.error('‚ùå Erreur:', error);
        notyf.error('Erreur lors du chargement des donn√©es');
    }
}

// ====== FONCTIONS D'AFFICHAGE DES STATISTIQUES ======

/**
 * Affiche les statistiques de cong√©s par type dans les cartes
 */
function afficherStatistiquesConges() {
    const container = document.querySelector('.grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-1.gap-6');
    if (!container) return;

    // Vider le conteneur
    container.innerHTML = '';

    // Cr√©er une carte pour chaque type de cong√© qui a des jours
    statistiquesParType.forEach((stat, index) => {
        if (stat.total_jours > 0) {
            const card = creerCarteStatistique(stat, index);
            container.appendChild(card);
        }
    });
}

/**
 * Cr√©e une carte HTML pour un type de cong√©
 */
function creerCarteStatistique(stat, index) {
    const card = document.createElement('div');
    card.className = 'bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg rounded-2xl shadow-xl border border-gray-200/50 dark:border-gray-700/50 p-6 animate-slide-up hover-lift';
    card.style.animationDelay = `${index * 0.1}s`;

    const icones = {
        'Cong√© maladie': 'fa-briefcase-medical',
        'Cong√© maternit√©': 'fa-baby',
        'Cong√©s pay√©s': 'fa-umbrella-beach',
        'Cong√É¬© maladie': 'fa-briefcase-medical',
        'Cong√É¬© maternit√É¬©': 'fa-baby',
        'Cong√É¬©s pay√É¬©s': 'fa-umbrella-beach',
        'RTT': 'fa-clock',
        'Sans solde': 'fa-money-bill-wave',
        'Cong√© paternit√©': 'fa-user-tie',
        'Cong√É¬© paternit√É¬©': 'fa-user-tie',
        'Cong√© autre': 'fa-calendar',
        'Cong√É¬© autre': 'fa-calendar',
        'Autre': 'fa-calendar'
    };

    const icone = icones[stat.type_nom] || 'fa-calendar';

    card.innerHTML = `
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background-color: ${stat.couleur}20;">
                    <i class="fas ${icone} text-xl" style="color: ${stat.couleur};"></i>
                </div>
                <div>
                    <h3 class="text-sm font-medium text-gray-600 dark:text-gray-400">${stat.type_nom}</h3>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">${stat.total_jours} jours</p>
                </div>
            </div>
        </div>
        <div class="space-y-2">
            <div class="flex justify-between text-sm">
                <span class="text-gray-600 dark:text-gray-400">Consomm√©s</span>
                <span class="font-semibold text-gray-900 dark:text-white">${stat.jours_ecoules} / ${stat.total_jours} jours</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: ${stat.pourcentage}%; background: ${stat.couleur};"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                <span>Restant: ${stat.jours_restants} jours</span>
                <span>${stat.pourcentage}%</span>
            </div>
        </div>
    `;

    return card;
}

// ====== FONCTIONS CALENDRIER ======

/**
 * Utility Functions
 */
function updateDateTime() {
    const now = new Date();
    const options = {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    };
    const dateElement = document.getElementById('current-date');
    if (dateElement) {
        dateElement.textContent = now.toLocaleDateString('fr-FR', options);
    }
}

function initTheme() {
    const theme = localStorage.getItem('theme') || 'light';
    document.documentElement.className = theme === 'dark' ? 'dark h-full' : 'h-full';
}

function toggleTheme() {
    const isDark = document.documentElement.classList.contains('dark');
    const newTheme = isDark ? 'light' : 'dark';
    document.documentElement.className = newTheme === 'dark' ? 'dark h-full' : 'h-full';
    localStorage.setItem('theme', newTheme);
    notyf.success(`Interface bascul√©e en mode ${newTheme === 'dark' ? 'sombre' : 'clair'}`);
}

// Calendar Functions
function getMonthName(month) {
    const months = [
        'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
        'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
    ];
    return months[month];
}

function getDaysInMonth(month, year) {
    return new Date(year, month + 1, 0).getDate();
}

function getFirstDayOfMonth(month, year) {
    const day = new Date(year, month, 1).getDay();
    return day === 0 ? 6 : day - 1;
}

function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

function isWeekend(date) {
    const day = date.getDay();
    return day === 0 || day === 6;
}

function isHoliday(date) {
    const dateStr = formatDate(date);
    return gabonHolidays[dateStr];
}

/**
 * ‚úÖ CORRIG√â V2 : R√©cup√®re le cong√© pour une date donn√©e
 * V√©rifie que la date fait partie des N jours ouvrables du cong√©
 */
function getLeaveForDate(date) {
    const dateStr = formatDate(date);

    // Ne pas colorier les weekends
    if (isWeekend(date)) {
        return null;
    }

    return congesApprouves.find(leave => {
        // Extraire la date de d√©but (enlever l'heure si pr√©sente)
        const debutStr = leave.date_debut.split(' ')[0];
        const dateDebut = new Date(debutStr);

        // Calculer les N jours ouvrables √† partir de la date de d√©but
        const joursOuvrablesConge = calculerJoursOuvrablesConge(dateDebut, leave.nb_jours);

        // V√©rifier si la date actuelle fait partie de ces jours ouvrables
        return joursOuvrablesConge.includes(dateStr);
    });
}

/**
 * ‚úÖ NOUVELLE FONCTION V2 : Calcule les dates des N jours ouvrables d'un cong√©
 * Retourne un tableau des dates (format YYYY-MM-DD) en sautant les weekends
 */
function calculerJoursOuvrablesConge(dateDebut, nbJours) {
    const joursOuvrables = [];
    let currentDate = new Date(dateDebut);
    let joursComptes = 0;

    while (joursComptes < nbJours) {
        // Si c'est un jour ouvrable (pas weekend), on le compte
        if (!isWeekend(currentDate)) {
            joursOuvrables.push(formatDate(currentDate));
            joursComptes++;
        }
        // Passer au jour suivant
        currentDate.setDate(currentDate.getDate() + 1);
    }

    return joursOuvrables;
}

/**
 * ‚úÖ FONCTION UTILITAIRE : Compte les jours ouvrables dans une p√©riode donn√©e
 */
function compterJoursOuvrables(dateDebut, dateFin) {
    let count = 0;
    let currentDate = new Date(dateDebut);
    const endDate = new Date(dateFin);

    while (currentDate <= endDate) {
        if (!isWeekend(currentDate)) {
            count++;
        }
        currentDate.setDate(currentDate.getDate() + 1);
    }

    return count;
}

function renderCalendar() {
    const grid = document.getElementById('calendar-grid');
    const monthElement = document.getElementById('current-month');
    const yearElement = document.getElementById('current-year');

    if (!grid) return;

    monthElement.textContent = getMonthName(calendarData.currentMonth);
    yearElement.textContent = calendarData.currentYear.toString();

    grid.innerHTML = '';

    const daysInMonth = getDaysInMonth(calendarData.currentMonth, calendarData.currentYear);
    const firstDay = getFirstDayOfMonth(calendarData.currentMonth, calendarData.currentYear);
    const today = new Date();

    // Jours du mois pr√©c√©dent (grille vide)
    for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day text-gray-300 dark:text-gray-600';
        const prevMonth = calendarData.currentMonth === 0 ? 11 : calendarData.currentMonth - 1;
        const prevYear = calendarData.currentMonth === 0 ? calendarData.currentYear - 1 : calendarData.currentYear;
        const prevMonthDays = getDaysInMonth(prevMonth, prevYear);
        emptyDay.textContent = prevMonthDays - firstDay + i + 1;
        grid.appendChild(emptyDay);
    }

    // Jours du mois actuel
    for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        const currentDate = new Date(calendarData.currentYear, calendarData.currentMonth, day);

        dayElement.className = 'calendar-day text-gray-700 dark:text-gray-300 rounded-xl font-medium relative';

        const dayNumber = document.createElement('div');
        dayNumber.textContent = day;
        dayElement.appendChild(dayNumber);

        // Marquer aujourd'hui
        if (currentDate.toDateString() === today.toDateString()) {
            dayElement.classList.add('today');
        }

        // V√©rifier si c'est un jour f√©ri√©
        const holidayName = isHoliday(currentDate);
        if (holidayName) {
            dayElement.classList.add('holiday');

            const badge = document.createElement('div');
            badge.className = 'holiday-badge';
            badge.title = holidayName;
            dayElement.appendChild(badge);

            dayElement.addEventListener('click', (e) => {
                e.stopPropagation();
                notyf.open({
                    type: 'info',
                    message: `üéâ ${holidayName}`,
                    duration: 3000
                });
            });

            dayElement.title = holidayName;
        } else {
            // ‚úÖ CORRECTION : V√©rifier si c'est un jour de cong√© OUVRABLE
            const leave = getLeaveForDate(currentDate);
            if (leave) {
                dayElement.classList.add('has-leave');
                dayElement.style.backgroundColor = leave.couleur + '40';
                dayElement.style.borderColor = leave.couleur;
                dayElement.style.borderWidth = '2px';
                dayElement.style.borderStyle = 'solid';

                // Titre pour le survol
                dayElement.title = `${leave.type_nom}: ${leave.motif || 'Pas de motif'}`;

                // Au clic, afficher les d√©tails complets
                dayElement.style.cursor = 'pointer';
            }
        }

        // Gestionnaire de clic
        dayElement.addEventListener('click', () => {
            if (!holidayName) {
                const leave = getLeaveForDate(currentDate);
                if (leave) {
                    afficherDetailsConge(leave);
                } else {
                    notyf.info(`${day} ${getMonthName(calendarData.currentMonth)} ${calendarData.currentYear}`);
                }
            }
        });

        grid.appendChild(dayElement);
    }

    // Jours du mois suivant (grille compl√®te)
    const totalCells = Math.ceil((daysInMonth + firstDay) / 7) * 7;
    const remainingCells = totalCells - (daysInMonth + firstDay);

    for (let i = 1; i <= remainingCells; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day text-gray-300 dark:text-gray-600';
        emptyDay.textContent = i;
        grid.appendChild(emptyDay);
    }
}

/**
 * ‚úÖ AM√âLIOR√â V2 : Affiche les d√©tails d'un cong√© avec calcul correct des jours ouvrables
 */
function afficherDetailsConge(conge) {
    const dateDebut = new Date(conge.date_debut.split(' ')[0]);

    // Calculer la vraie date de fin bas√©e sur le nombre de jours ouvrables
    const joursOuvrablesConge = calculerJoursOuvrablesConge(dateDebut, conge.nb_jours);
    const derniereDate = joursOuvrablesConge[joursOuvrablesConge.length - 1];
    const dateFin = new Date(derniereDate);

    const dateDebutFormatted = dateDebut.toLocaleDateString('fr-FR', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    const dateFinFormatted = dateFin.toLocaleDateString('fr-FR', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

    // Cr√©er un message HTML format√© pour le toast
    const messageHTML = `
        <div style="text-align: left; line-height: 1.6;">
            <div style="font-size: 18px; font-weight: bold; margin-bottom: 12px; color: ${conge.couleur}; border-bottom: 2px solid ${conge.couleur}; padding-bottom: 8px;">
                üìã ${conge.type_nom}
            </div>
            <div style="font-size: 14px; margin-bottom: 8px;">
                <strong>üóìÔ∏è P√©riode:</strong><br/>
                <span style="margin-left: 20px;">Du ${dateDebutFormatted}</span><br/>
                <span style="margin-left: 20px;">Au ${dateFinFormatted}</span>
            </div>
            <div style="font-size: 14px; margin-bottom: 8px;">
                <strong>‚è±Ô∏è Dur√©e:</strong> <span style="font-weight: bold; color: ${conge.couleur};">${conge.nb_jours} jour(s) ouvrable(s)</span>
            </div>
            <div style="font-size: 14px; margin-bottom: 8px;">
                <strong>üìä Progression:</strong> ${conge.jours_ecoules} / ${conge.nb_jours} jours
                <span style="background: ${conge.couleur}; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-left: 5px;">${conge.pourcentage}%</span>
            </div>
            <div style="font-size: 13px; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(0,0,0,0.1);">
                <strong>üí¨ Motif:</strong><br/>
                <span style="margin-left: 20px; font-style: italic; color: #666;">${conge.motif || 'Aucun motif sp√©cifi√©'}</span>
            </div>
        </div>
    `;

    // Afficher un toast personnalis√© avec une dur√©e plus longue
    notyf.open({
        type: 'success',
        message: messageHTML,
        duration: 10000,
        ripple: true,
        dismissible: true,
        position: { x: 'right', y: 'top' }
    });
}

/**
 * ‚úÖ CORRIG√â : Affiche la l√©gende avec les types de cong√©s utilis√©s
 */
function afficherLegende() {
    const legendContainer = document.querySelector('.grid.grid-cols-2.md\\:grid-cols-3.lg\\:grid-cols-7.gap-4');
    if (!legendContainer) return;

    legendContainer.innerHTML = '';

    // Jour f√©ri√©
    const holidayItem = document.createElement('div');
    holidayItem.className = 'legend-item flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-xl hover:shadow-md transition-shadow';
    holidayItem.innerHTML = `
        <div class="w-4 h-4 bg-red-500 rounded-full shadow-sm"></div>
        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Jour f√©ri√©</span>
    `;
    legendContainer.appendChild(holidayItem);

    // Types de cong√©s - R√©cup√©rer depuis les cong√©s approuv√©s
    const typesUtilises = new Map();

    congesApprouves.forEach(conge => {
        if (!typesUtilises.has(conge.type_id)) {
            typesUtilises.set(conge.type_id, {
                nom: conge.type_nom,
                couleur: conge.couleur
            });
        }
    });

    console.log('üìä Types de cong√©s utilis√©s:', Array.from(typesUtilises.entries()));

    // Cr√©er les items de l√©gende
    typesUtilises.forEach((type, typeId) => {
        const item = document.createElement('div');
        item.className = 'legend-item flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-xl hover:shadow-md transition-shadow';
        item.innerHTML = `
            <div class="w-4 h-4 rounded-full shadow-sm" style="background-color: ${type.couleur};"></div>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">${type.nom}</span>
        `;
        legendContainer.appendChild(item);
    });
}

function navigateMonth(direction) {
    if (direction === 'prev') {
        if (calendarData.currentMonth === 0) {
            calendarData.currentMonth = 11;
            calendarData.currentYear--;
        } else {
            calendarData.currentMonth--;
        }
    } else {
        if (calendarData.currentMonth === 11) {
            calendarData.currentMonth = 0;
            calendarData.currentYear++;
        } else {
            calendarData.currentMonth++;
        }
    }
    renderCalendar();
    notyf.info(`${getMonthName(calendarData.currentMonth)} ${calendarData.currentYear}`);
}

// Sidebar Management
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    if (sidebar && overlay) {
        sidebar.classList.toggle('show');
        overlay.classList.toggle('show');
    }
}

function closeSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    if (sidebar && overlay) {
        sidebar.classList.remove('show');
        overlay.classList.remove('show');
    }
}

// Notifications Management
function toggleNotifications() {
    const dropdown = document.getElementById('notifications-dropdown');
    if (dropdown) {
        dropdown.classList.toggle('show');
    }
}

// Event Listeners
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üöÄ Initialisation du calendrier...');

    // Charger les donn√©es depuis le backend
    await chargerDonneesConges();

    initTheme();
    updateDateTime();
    setInterval(updateDateTime, 1000);

    setTimeout(() => {
    }, 1000);

    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
    }

    const toggleSidebarBtn = document.getElementById('toggle-sidebar');
    if (toggleSidebarBtn) {
        toggleSidebarBtn.addEventListener('click', toggleSidebar);
    }

    const closeSidebarBtn = document.getElementById('close-sidebar');
    if (closeSidebarBtn) {
        closeSidebarBtn.addEventListener('click', closeSidebar);
    }

    const sidebarOverlay = document.getElementById('sidebar-overlay');
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', closeSidebar);
    }

    const prevMonthBtn = document.getElementById('prev-month');
    if (prevMonthBtn) {
        prevMonthBtn.addEventListener('click', () => navigateMonth('prev'));
    }

    const nextMonthBtn = document.getElementById('next-month');
    if (nextMonthBtn) {
        nextMonthBtn.addEventListener('click', () => navigateMonth('next'));
    }

    const notificationsBtn = document.getElementById('notifications-btn');
    if (notificationsBtn) {
        notificationsBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleNotifications();
        });
    }

    document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('notifications-dropdown');
        const btn = document.getElementById('notifications-btn');

        if (dropdown && btn && !dropdown.contains(e.target) && !btn.contains(e.target)) {
            dropdown.classList.remove('show');
        }
    });

    // Raccourcis clavier
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + D : Toggle Dark Mode
        if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
            e.preventDefault();
            toggleTheme();
        }

        // Ctrl + Fl√®che Gauche : Mois pr√©c√©dent
        if (e.key === 'ArrowLeft' && e.ctrlKey) {
            e.preventDefault();
            navigateMonth('prev');
        }

        // Ctrl + Fl√®che Droite : Mois suivant
        if (e.key === 'ArrowRight' && e.ctrlKey) {
            e.preventDefault();
            navigateMonth('next');
        }

        // Escape : Fermer sidebar et notifications
        if (e.key === 'Escape') {
            closeSidebar();
            const dropdown = document.getElementById('notifications-dropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }
    });

    console.log('‚úÖ Calendrier des cong√©s initialis√© avec succ√®s!');
    console.log('üìÖ Jours f√©ri√©s du Gabon charg√©s');
    console.log('üé® Raccourcis clavier disponibles:');
    console.log('   - Ctrl/Cmd + D : Mode sombre/clair');
    console.log('   - Ctrl + ‚Üê : Mois pr√©c√©dent');
    console.log('   - Ctrl + ‚Üí : Mois suivant');
    console.log('   - Escape : Fermer les menus');
});

// Gestion du redimensionnement de la fen√™tre
window.addEventListener('resize', function() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    // Fermer la sidebar automatiquement sur grand √©cran
    if (sidebar && overlay && window.innerWidth >= 768) {
        sidebar.classList.remove('show');
        overlay.classList.remove('show');
    }
});

console.log('üóìÔ∏è Graxel Tech Calendar Module Loaded - Version 2.2 CORRIG√â FINAL');
console.log('üìç Jours f√©ri√©s du Gabon 2025-2030 inclus');
console.log('‚ú® Corrections FINALES appliqu√©es:');
console.log('   ‚úÖ Le nb_jours repr√©sente des JOURS OUVRABLES (lundi-vendredi)');
console.log('   ‚úÖ Les weekends sont automatiquement saut√©s');
console.log('   ‚úÖ Le calendrier colorie exactement nb_jours jours ouvrables');
console.log('   ‚úÖ Exemple: 7 jours de cong√© du jeudi 20 novembre:');
console.log('       ‚Üí Colorie: Jeu 20, Ven 21, Lun 24, Mar 25, Mer 26, Jeu 27, Ven 28');
console.log('       ‚Üí Saute: Sam 22, Dim 23 (weekends)');
console.log('       ‚Üí Total: 7 jours ouvrables respect√©s ‚úì');
